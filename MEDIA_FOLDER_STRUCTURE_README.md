# Структура папок для медиафайлов товаров

## Описание изменений

При создании товара и загрузке фото/видео файлов теперь создается следующая структура папок:

```
storage/app/public/products/
├── Артикул_Организации_1/
│   ├── Артикул_Товара_1/
│   │   ├── 20241201123456_abc123de.jpg
│   │   ├── 20241201123457_def456gh.mp4
│   │   └── ...
│   └── Артикул_Товара_2/
│       ├── 20241201123458_ghi789jk.png
│       └── ...
└── Артикул_Организации_2/
    └── Артикул_Товара_3/
        └── ...
```

## Правила транслитерации

### Артикул организации
- Кириллица заменяется на латиницу
- Тире (-) заменяется на нижнее подчеркивание (_)
- Все остальные символы удаляются
- Множественные подчеркивания заменяются одним
- Подчеркивания в начале и конце удаляются

### Артикул товара
- Применяются те же правила транслитерации
- Если артикул пустой или содержит только недопустимые символы, используется 'unknown'

## Примеры транслитерации

| Исходный текст | Результат |
|----------------|-----------|
| ABC-123 | ABC_123 |
| ООО-Рога-и-Копыта | OOO_Roga_i_Kopyta |
| Токарный-16К20 | Tokarnyy_16K20 |
| Станок-ЧПУ-2024 | Stanok_CHPU_2024 |
| Компания-с-кириллицей | Kompaniya_s_kirillicey |
| ---test--- | test |
| МАШИНА-СТРОИТЕЛЬНАЯ | MASHINA_STROITELNAYA |

## Изменения в коде

### ProductController.php

1. **Метод `handleMediaFiles()`** - обновлен для создания структуры папок
2. **Метод `transliterate()`** - новый приватный метод для транслитерации
3. **Метод `testTransliterate()`** - публичный метод для тестирования

### Логика работы

1. При загрузке файлов получаем артикул организации и товара
2. Транслитерируем оба артикула
3. Создаем путь: `products/{артикул_организации}/{артикул_товара}/`
4. Сохраняем файлы в созданную структуру папок

## Тестирование

Для тестирования функции транслитерации доступны:

1. **API endpoint**: `GET /test-transliterate/{string}`
2. **Тестовая страница**: `GET /test-transliterate-page`

## Совместимость

- Изменения применяются как при создании нового товара, так и при обновлении существующего
- Старые файлы остаются в прежней структуре папок
- Новые файлы сохраняются в новой структуре

## Удаление тестовых маршрутов

После тестирования необходимо удалить:

1. Маршрут `/test-transliterate/{string}` из `routes/web.php`
2. Маршрут `/test-transliterate-page` из `routes/web.php`
3. Файл `resources/views/test-transliterate.blade.php`
4. Метод `testTransliterate()` из `ProductController.php` 