# Функциональность логов и действий товаров

## Описание

Добавлена функциональность для отображения логов событий и управления действиями товаров, аналогичная функциональности компаний. Реализованы блоки "Следующие действия" и "Лог событий" на странице просмотра товара.

## Что было реализовано

### 1. Обновлены модели

#### ProductLog
- Добавлены отношения к `LogType`, `User` и `Product`
- Поддержка типизированных логов с цветовой индикацией

#### ProductAction
- Добавлены отношения к `Product` и `User`
- Поддержка статусов выполнения и дат истечения
- Автоматическое создание логов при выполнении действий

#### Product
- Добавлены отношения к `ProductLog` и `ProductAction`

### 2. Обновлен контроллер `ProductController`
- В методе `show()` добавлена загрузка последнего лога и действия товара
- Добавлены методы для работы с логами и действиями:
  - `getLogs()` - получение всех логов товара
  - `getActions()` - получение всех действий товара
  - `storeAction()` - создание нового действия
  - `completeAction()` - отметка действия как выполненного

### 3. Добавлены маршруты
```php
Route::get('/product/{product}/logs', [ProductController::class, 'getLogs']);
Route::get('/product/{product}/actions', [ProductController::class, 'getActions']);
Route::post('/product/{product}/actions', [ProductController::class, 'storeAction']);
Route::post('/product/{product}/actions/{actionId}/complete', [ProductController::class, 'completeAction']);
```

### 4. Обновлено представление `ProductItemPage.blade.php`
- Заменены статические блоки на динамические
- Добавлены модальные окна для:
  - Просмотра истории логов
  - Управления действиями
  - Создания новых действий
  - Завершения действий с комментариями

### 5. Добавлены команды для тестирования
- `CreateTestProductLog` - создание тестовых логов
- `CreateTestProductAction` - создание тестовых действий
- `TestProductLog` - тестирование функциональности логов

## Структура данных

### Таблица `product_logs`
- `id` - уникальный идентификатор
- `product_id` - ID товара
- `user_id` - ID пользователя (может быть NULL)
- `type_id` - ID типа лога
- `log` - текст лога
- `created_at` - дата создания
- `updated_at` - дата обновления

### Таблица `product_actions`
- `id` - уникальный идентификатор
- `product_id` - ID товара
- `user_id` - ID пользователя
- `action` - описание действия
- `expired_at` - дата истечения срока
- `status` - статус выполнения (boolean)
- `completed_at` - дата выполнения (nullable)
- `created_at` - дата создания
- `updated_at` - дата обновления

### Таблица `log_types` (используется совместно с компаниями)
- `id` - уникальный идентификатор
- `name` - название типа (например, "Комментарий", "Системный")
- `color` - цвет в формате HEX (например, "#133E71", "#6c757d")

## Команды для тестирования

### Просмотр логов товара
```bash
php artisan test:product-log {product_id}
```

### Создание тестового лога
```bash
php artisan create:test-product-log {product_id} --type=1 --user=null --message="Тестовый лог товара"
```

### Создание тестового действия
```bash
php artisan create:test-product-action {product_id} --user=1 --action="Проверить статус товара" --expired_at="+7 days"
```

Параметры:
- `product_id` - ID товара (обязательный)
- `--type` - ID типа лога (по умолчанию 1)
- `--user` - ID пользователя (по умолчанию null для логов, 1 для действий)
- `--message` - текст лога (по умолчанию "Тестовый лог товара")
- `--action` - описание действия (по умолчанию "Проверить статус товара")
- `--expired_at` - дата истечения (по умолчанию "+7 days")

## Примеры использования

### Создание системного лога
```bash
php artisan create:test-product-log 1 --type=2 --user=null --message="Система обновила статус товара"
```

### Создание лога от пользователя
```bash
php artisan create:test-product-log 1 --type=1 --user=1 --message="Проверил товар, все в порядке"
```

### Создание действия с истечением через 3 дня
```bash
php artisan create:test-product-action 1 --user=1 --action="Позвонить клиенту" --expired_at="+3 days"
```

## Отображение на странице

### Блок "Следующие действия"
Отображается:
1. **Дата истечения** - в формате `dd.mm.yyyy`
2. **Описание действия** - текст задачи
3. **Кнопки управления** - "Задать новое действие" и "Подробнее"

Если действий нет, показывается сообщение "Нет активных действий".

### Блок "Лог событий"
Отображается:
1. **Тип лога** - с соответствующим цветом
2. **Дата и время** - в формате `dd.mm.yyyy hh:mm:ss`
3. **Текст лога** - содержимое поля `log`
4. **Создатель** - имя пользователя или "Система" если `user_id = NULL`

Если логов нет, отображается сообщение "Логи событий отсутствуют".

## Модальные окна

### История логов
- Показывает все логи товара в хронологическом порядке
- Поддерживает прокрутку для большого количества записей
- Отображает тип, дату, текст и создателя каждого лога

### Управление действиями
- Показывает все действия товара
- Выполненные действия отображаются с зачеркиванием
- Возможность отметить действие как выполненное с комментарием

### Создание нового действия
- Форма с полями для описания и даты истечения
- Валидация даты (не раньше завтра)
- Счетчик символов для описания (максимум 1000)

## Автоматическое создание логов

При выполнении действий автоматически создаются логи:
- При создании действия: "Пользователь: {имя}, создал новую задачу: "{действие}" со сроком до {дата}"
- При выполнении действия: "Пользователь: {имя}, выполнил задачу "{действие}" с комментарием: {комментарий}"

## Интеграция с существующей системой

Функциональность полностью интегрирована с существующей системой:
- Использует те же типы логов, что и компании
- Поддерживает те же права доступа
- Следует тем же паттернам UI/UX
- Совместима с существующими стилями и компонентами
