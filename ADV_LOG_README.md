# Логи и действия объявлений

## Описание

Реализована функциональность для работы с логами событий и действиями объявлений, аналогично тому, как это сделано для товаров.

## Модели

### AdvLog (Логи объявлений)
- **Связи:**
  - `type()` - связь с типом лога (LogType)
  - `user()` - связь с пользователем
  - `advertisement()` - связь с объявлением

### AdvAction (Действия объявлений)
- **Связи:**
  - `advertisement()` - связь с объявлением
  - `user()` - связь с пользователем
- **Поля:**
  - `action` - описание действия
  - `expired_at` - срок выполнения
  - `status` - статус выполнения (boolean)
  - `completed_at` - дата выполнения

### Advertisement (Обновленная модель)
Добавлены новые связи:
- `logs()` - связь с логами объявления
- `actions()` - связь с действиями объявления

## Контроллер

### AdvertisementController
Добавлены новые методы:

#### `getLogs(Advertisement $advertisement)`
- Получает все логи объявления
- Возвращает JSON с логами и связанными данными

#### `getActions(Advertisement $advertisement)`
- Получает все действия объявления
- Возвращает JSON с действиями

#### `storeAction(Request $request, Advertisement $advertisement)`
- Создает новое действие для объявления
- Валидирует данные (действие и срок)
- Создает лог о создании действия
- Возвращает JSON с созданным действием

#### `completeAction(Request $request, Advertisement $advertisement, $actionId)`
- Отмечает действие как выполненное
- Валидирует комментарий к выполнению
- Создает лог о выполнении действия
- Возвращает JSON с результатом

## Маршруты

Добавлены новые маршруты для работы с логами и действиями:

```php
// Маршруты для логов и действий объявлений
Route::get('/advertisements/{advertisement}/logs', [AdvertisementController::class, 'getLogs']);
Route::get('/advertisements/{advertisement}/actions', [AdvertisementController::class, 'getActions']);
Route::post('/advertisements/{advertisement}/actions', [AdvertisementController::class, 'storeAction']);
Route::post('/advertisements/{advertisement}/actions/{actionId}/complete', [AdvertisementController::class, 'completeAction']);
```

## Представление

### AdvertisementShowPage.blade.php

#### Обновленный блок "Следующие действия"
- Отображает последнее невыполненное действие
- Показывает дату выполнения и описание
- Кнопки для создания нового действия, выполнения текущего и просмотра истории

#### Обновленный блок "Лог событий"
- Отображает последний лог объявления
- Показывает тип события, дату, описание и пользователя
- Кнопка для просмотра полной истории

#### Модальные окна
1. **Создание действия** - форма для создания нового действия
2. **Выполнение действия** - форма для отметки действия как выполненного
3. **История действий** - список всех действий объявления
4. **История логов** - список всех логов объявления

#### JavaScript функции
- `showCreateActionModal()` - открытие модального окна создания действия
- `showCompleteActionModal()` - открытие модального окна выполнения действия
- `showActionsHistory()` - загрузка и отображение истории действий
- `showLogsHistory()` - загрузка и отображение истории логов
- `createAction()` - создание нового действия через AJAX
- `completeAction()` - выполнение действия через AJAX
- `displayActionsHistory()` - отображение истории действий
- `displayLogsHistory()` - отображение истории логов

## Команды для тестирования

### CreateTestAdvLog
```bash
php artisan test:create-adv-log
```
Создает тестовые логи для всех объявлений.

### CreateTestAdvAction
```bash
php artisan test:create-adv-action
```
Создает тестовые действия для всех объявлений.

## Использование

1. **Просмотр действий и логов:**
   - Откройте страницу объявления
   - В правой части будут отображаться блоки "Следующие действия" и "Лог событий"

2. **Создание нового действия:**
   - Нажмите кнопку "Задать новое действие"
   - Заполните описание и срок выполнения
   - Нажмите "Создать"

3. **Выполнение действия:**
   - Нажмите кнопку "Выполнить" рядом с действием
   - Добавьте комментарий к выполнению
   - Нажмите "Выполнить"

4. **Просмотр истории:**
   - Нажмите кнопку "История" в соответствующем блоке
   - Просмотрите полный список действий или логов

## Особенности реализации

- Все операции выполняются через AJAX без перезагрузки страницы
- Автоматическое создание логов при создании и выполнении действий
- Валидация данных на стороне сервера
- Уведомления об успешных операциях и ошибках
- Адаптивный дизайн модальных окон
- Интеграция с существующей системой уведомлений
